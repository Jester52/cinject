<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Mago - Monitor Remoto</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #1a1a1a; 
            color: #00ff00; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
        }
        .monitor { 
            border: 2px solid #00ff00; 
            padding: 40px; 
            border-radius: 8px; 
            background: #000; 
            box-shadow: 0 0 20px rgba(0,255,0,0.2); 
            text-align: center; 
            min-width: 300px; 
        }
        .label { 
            color: #888; 
            text-transform: uppercase; 
            font-size: 12px; 
            letter-spacing: 2px; 
            margin-bottom: 10px; 
        }
        #word { 
            font-size: 48px; 
            font-weight: bold; 
            margin: 0; 
            word-wrap: break-word; 
        }
        .status { 
            margin-top: 20px; 
            font-size: 10px; 
            color: #444; 
        }
        .sala-info {
            margin-top: 10px;
            color: #555;
            font-size: 9px;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <div class="monitor">
        <div class="label" id="titulo-estado">Búsqueda detectada en la nube:</div>
        <p id="word">CONECTANDO...</p>
        <div id="status-text" class="status">Esperando señal de Firebase...</div>
        <div id="sala-name" class="sala-info"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        // 1. CONFIGURACIÓN DEL PROYECTO
        const firebaseConfig = {
            apiKey: "AIzaSyCqNmPPbSLzw7SkQp2QQ1YFNGaCRFSqeQQ",
            authDomain: "cinyect.firebaseapp.com",
            databaseURL: "https://cinyect-default-rtdb.firebaseio.com",
            projectId: "cinyect",
            storageBucket: "cinyect.firebasestorage.app",
            messagingSenderId: "747813074248",
            appId: "1:747813074248:web:a7eec94a6211f45a1a2f7d"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 2. DETECCIÓN DE SALA (ID de Usuario)
        const urlParams = new URLSearchParams(window.location.search);
        const miSala = urlParams.get('id') || 'general';
        document.getElementById('sala-name').textContent = "SALA ACTIVA: " + miSala.toUpperCase();

        // 3. LÓGICA DE ESCUCHA DINÁMICA
        // Apuntamos a la ruta usuarios/nombre_del_mago
        database.ref(`usuarios/${miSala}/busquedaActual`).on('value', (snapshot) => {
            const data = snapshot.val();
            const txtPalabra = document.getElementById('word');
            const txtStatus = document.getElementById('status-text');
            const txtTitulo = document.getElementById('titulo-estado');

            if (data && data.palabra) {
                
                // CASO A: Es una señal de RESET
                if (data.palabra === "RESET") {
                    txtPalabra.textContent = "ESPERANDO...";
                    txtPalabra.style.color = "#444"; 
                    txtStatus.textContent = "Sistema Reiniciado - Listo";
                    txtTitulo.textContent = "Monitor en espera";
                } 
                // CASO B: Es una búsqueda real
                else {
                    txtPalabra.textContent = data.palabra.toUpperCase();
                    txtPalabra.style.color = "#00ff00"; 
                    txtStatus.textContent = "Sincronizado: " + new Date().toLocaleTimeString();
                    txtTitulo.textContent = "Búsqueda detectada:";
                }

            } else {
                txtPalabra.textContent = "LISTO";
                txtStatus.textContent = "Conectado a Firebase - Sala: " + miSala;
            }
        });
    </script>
</body>
</html>